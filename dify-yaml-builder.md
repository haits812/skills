---
name: dify-yaml-builder
description: 対話形式でDifyワークフローのYAMLを作成する。「Difyのワークフローを作りたい」「DifyのYAMLを生成して」「チャットボットのフローを作って」などのリクエストに使用。Chatflow（会話型）とWorkflow（バッチ処理型）の両方に対応。ユーザーから要件を段階的にヒアリングし、公式ドキュメントを参照しながら正確なYAMLを生成する。
---

# Dify YAML Builder

対話形式でDifyワークフローのYAMLを生成するスキル。

## ヒアリングプロセス

以下の順序で段階的に質問する。一度に多くの質問をせず、1-2問ずつ進める。

### Phase 1: 基本情報

1. **目的の確認**
   - 「どんなワークフローを作りたいですか？やりたいことを教えてください」
   
2. **タイプの確定**
   - Chatflow: 会話型、マルチターン対話、チャットボット向け
   - Workflow: 単発処理、バッチ処理、API呼び出し向け
   - 迷っている場合は用途から提案する

3. **バージョン確認**（必要に応じて）
   - 指定がなければ最新版を想定
   - 指定があればそのバージョンに従う

### Phase 2: 入出力の定義

4. **入力の確認**
   - 「ワークフローへの入力は何ですか？（例：ユーザーの質問、ファイル、特定のデータなど）」
   - 変数名、型、説明を整理

5. **出力の確認**
   - 「最終的に何を出力したいですか？」
   - 回答テキスト、生成ファイル、API応答など

### Phase 3: 処理フローの設計

6. **処理ステップの洗い出し**
   - 「入力から出力までの間に、どんな処理が必要ですか？」
   - 箇条書きで整理してもらう

7. **条件分岐の有無**
   - 「途中で条件によって処理を分けたい場面はありますか？」

8. **繰り返し処理の有無**
   - 「複数の項目に対して同じ処理を繰り返す必要はありますか？」

9. **外部連携の確認**
   - 「外部のAPIやデータベースとの連携は必要ですか？」

### Phase 4: 詳細設計

10. **LLMノードの設定**
    - 使用モデル（GPT-4、Claude、etc.）
    - プロンプトの内容
    - 温度などのパラメータ

11. **エラーハンドリング**
    - 「エラー時の動作はどうしますか？（デフォルトメッセージ、リトライなど）」

## 公式ドキュメントの参照

YAML生成前に必ず公式ドキュメントを確認して最新仕様を取得する。

### 公式リソース

| リソース | URL | 用途 |
|----------|-----|------|
| 公式ドキュメント | https://docs.dify.ai/ | ノード仕様、設定方法 |
| GitHub | https://github.com/langgenius/dify | ソースコード、最新変更 |
| DSL定義 | https://github.com/langgenius/dify/tree/main/api/core/app/segments | YAML構造の詳細 |

### 確認手順

1. `web_fetch`で公式ドキュメントの該当ページを取得
2. 不明点は`web_search`で「site:docs.dify.ai [検索語]」で検索
3. 最新仕様変更はGitHubのリリースノートを確認

### 確認すべき項目

- ノードタイプごとの必須フィールド
- 変数参照の書式（`{{#node_id.output#}}`など）
- エッジ（接続）の定義方法
- バージョン固有の仕様差異

## YAML生成ルール

### 基本構造

```yaml
app:
  name: [ワークフロー名]
  mode: [workflow|chat]
  description: [説明]

workflow:
  graph:
    nodes: [...]
    edges: [...]
  features: [...]
```

### ノード定義の共通形式

```yaml
- id: [一意のID]
  type: [ノードタイプ]
  data:
    title: [表示名]
    # ノード固有の設定
  position:
    x: [X座標]
    y: [Y座標]
```

### 主要ノードタイプ

| タイプ | 用途 |
|--------|------|
| start | 開始ノード、入力変数定義 |
| end | 終了ノード、出力定義 |
| llm | LLM呼び出し |
| code | Python/JavaScriptコード実行 |
| http-request | 外部API呼び出し |
| if-else | 条件分岐 |
| iteration | 繰り返し処理 |
| variable-aggregator | 変数の集約 |
| template-transform | テンプレート変換 |
| knowledge-retrieval | ナレッジベース検索 |
| question-classifier | 質問分類 |
| parameter-extractor | パラメータ抽出 |

### 変数参照の書式

```
{{#node_id.output_variable#}}
```

- `node_id`: 参照先ノードのID
- `output_variable`: 出力変数名

## 生成フロー

1. ヒアリング完了後、要件を箇条書きで確認
2. ユーザーの承認を得る
3. 公式ドキュメントをweb検索で確認
4. YAML生成
5. 生成したYAMLの説明を添える
6. `.yml`ファイルとして出力

## 注意事項

- ノードIDは`node_`プレフィックス + 連番を推奨
- 座標は左から右へ、上から下への流れで配置
- 複雑なフローは図解説明を添える
- 生成後は「Difyにインポートして動作確認してください」と案内
